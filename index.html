<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô ‡∏°‡∏ß.‡∏™.</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .github-gradient {
            background: linear-gradient(135deg, #24292e 0%, #586069 50%, #0366d6 100%);
        }
        .pulse-glow {
            animation: pulseGlow 2s ease-in-out infinite;
        }
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 5px rgba(3, 102, 214, 0.3); }
            50% { box-shadow: 0 0 20px rgba(3, 102, 214, 0.6); }
        }
        .slide-up {
            animation: slideUp 0.4s ease-out;
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .notification-enter {
            animation: notificationEnter 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        @keyframes notificationEnter {
            0% { opacity: 0; transform: translateX(100%) scale(0.8); }
            100% { opacity: 1; transform: translateX(0) scale(1); }
        }
        .stats-card {
            transition: all 0.3s ease;
        }
        .stats-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 8px;
        }
        .version-badge {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 via-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-6">
        <!-- Enhanced Header -->
        <header class="text-center mb-8"> 
            <h1 class="text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-3">
                 ‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå ‡∏°‡∏ß.‡∏™.
            </h1>
            <!-- Quick Stats Dashboard -->
            <div id="quickStats" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <!-- Stats will be populated by JavaScript -->
            </div>
        </header>

        <!-- Enhanced Navigation -->
        <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl mb-8 overflow-hidden">
            <div class="flex flex-wrap border-b border-gray-200">
                <button onclick="showTab('borrow')" id="borrowTab" 
                        class="flex-1 min-w-0 py-4 px-4 text-center font-semibold border-b-3 border-indigo-500 text-indigo-600 transition-all duration-300">
                    <div class="flex items-center justify-center gap-2">
                        <span class="text-xl">üì§</span>
                        <span class="hidden sm:inline">‡∏¢‡∏∑‡∏°‡∏Ç‡∏≠‡∏á</span>
                    </div>
                </button>
                <button onclick="showTab('return')" id="returnTab" 
                        class="flex-1 min-w-0 py-4 px-4 text-center font-semibold text-gray-500 hover:text-gray-700 transition-all duration-300">
                    <div class="flex items-center justify-center gap-2">
                        <span class="text-xl">üì•</span>
                        <span class="hidden sm:inline">‡∏Ñ‡∏∑‡∏ô‡∏Ç‡∏≠‡∏á</span>
                    </div>
                </button>
                <button onclick="showTab('history')" id="historyTab" 
                        class="flex-1 min-w-0 py-4 px-4 text-center font-semibold text-gray-500 hover:text-gray-700 transition-all duration-300">
                    <div class="flex items-center justify-center gap-2">
                        <span class="text-xl">üìã</span>
                        <span class="hidden sm:inline">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</span>
                    </div>
                </button>
                <button onclick="showTab('analytics')" id="analyticsTab" 
                        class="flex-1 min-w-0 py-4 px-4 text-center font-semibold text-gray-500 hover:text-gray-700 transition-all duration-300">
                    <div class="flex items-center justify-center gap-2">
                        <span class="text-xl">üìä</span>
                        <span class="hidden sm:inline">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</span>
                    </div>
                </button>
                <button onclick="showTab('settings')" id="settingsTab" 
                        class="flex-1 min-w-0 py-4 px-4 text-center font-semibold text-gray-500 hover:text-gray-700 transition-all duration-300">
                    <div class="flex items-center justify-center gap-2">
                        <span class="text-xl">‚öôÔ∏è</span>
                        <span class="hidden sm:inline">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
                    </div>
                </button>
            </div>

            <!-- Borrow Section -->
            <div id="borrowSection" class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">üì§ ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏¢‡∏∑‡∏°‡∏Ç‡∏≠‡∏á</h2>
                    <button onclick="clearBorrowForm()" class="text-gray-500 hover:text-gray-700 text-sm">
                        üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
                    </button>
                </div>
                
                <form id="borrowForm" class="space-y-6">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label for="borrowerName" class="block text-sm font-semibold text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏° *</label>
                            <input type="text" id="borrowerName" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300"
                                   placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°">
                        </div>
                        <div class="space-y-2">
                            <label for="borrowerPhone" class="block text-sm font-semibold text-gray-700">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ *</label>
                            <input type="tel" id="borrowerPhone" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300"
                                   placeholder="0xx-xxx-xxxx">
                        </div>
                    </div>
                    
                    <div class="space-y-2">
                        <label for="itemName" class="block text-sm font-semibold text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏° *</label>
                        <input type="text" id="itemName" required 
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300"
                               placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°">
                    </div>
                    
                    <div class="space-y-6">
                        <div class="space-y-2">
                            <label for="borrowDate" class="block text-sm font-semibold text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏° *</label>
                            <input type="date" id="borrowDate" required 
                                   class="w-full px-4 py-4 text-lg border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300">
                        </div>
                        <div class="space-y-2">
                            <label for="returnDate" class="block text-sm font-semibold text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∑‡∏ô (‡∏Å‡∏≥‡∏´‡∏ô‡∏î) *</label>
                            <input type="date" id="returnDate" required 
                                   class="w-full px-4 py-4 text-lg border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300">
                        </div>
                    </div>
                    
                    <div class="space-y-2">
                        <label for="notes" class="block text-sm font-semibold text-gray-700">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                        <textarea id="notes" rows="3" 
                                  class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300"
                                  placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)"></textarea>
                    </div>
                    
                    <div class="space-y-2">
                        <label for="borrowImages" class="block text-sm font-semibold text-gray-700">üì∑ ‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</label>
                        <input type="file" id="borrowImages" multiple accept="image/*" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300">
                        <p class="text-xs text-gray-500">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö JPG, PNG, GIF - ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô Browser LocalStorage</p>
                        <div id="borrowImagePreview" class="mt-3 image-grid"></div>
                    </div>
                    
                    <button type="submit" 
                            class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white py-4 px-6 rounded-xl font-semibold text-lg transition-all duration-300 transform hover:scale-[1.02] shadow-lg">
                        üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°
                    </button>
                </form>
            </div>

            <!-- Return Section -->
            <div id="returnSection" class="p-6 hidden">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">üì• ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ñ‡∏∑‡∏ô‡∏Ç‡∏≠‡∏á</h2>
                    <div class="text-sm text-gray-500">
                        <span id="activeItemsCount">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏Ñ‡∏∑‡∏ô
                    </div>
                </div>
                
                <div class="mb-6">
                    <div class="relative">
                        <input type="text" id="searchBorrow" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°, ‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á, ‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà" 
                               class="w-full px-4 py-3 pl-12 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300">
                        <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
                            üîç
                        </div>
                    </div>
                </div>
                
                <div id="borrowList" class="space-y-4 mb-6">
                    <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
                </div>
                
                <form id="returnForm" class="space-y-6 hidden bg-gray-50 p-6 rounded-xl">
                    <input type="hidden" id="returnBorrowId">
                    <div class="bg-white p-4 rounded-xl border border-gray-200">
                        <h3 class="font-semibold text-gray-800 mb-3">üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</h3>
                        <div id="returnItemInfo" class="text-sm text-gray-600"></div>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label for="actualReturnDate" class="block text-sm font-semibold text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∑‡∏ô‡∏à‡∏£‡∏¥‡∏á *</label>
                            <input type="date" id="actualReturnDate" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-300">
                        </div>
                        <div class="space-y-2">
                            <label for="condition" class="block text-sm font-semibold text-gray-700">‡∏™‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á *</label>
                            <select id="condition" required 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-300">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏†‡∏≤‡∏û</option>
                                <option value="‡∏î‡∏µ‡∏°‡∏≤‡∏Å">‡∏î‡∏µ‡∏°‡∏≤‡∏Å ‚ú®</option>
                                <option value="‡∏î‡∏µ">‡∏î‡∏µ ‚úÖ</option>
                                <option value="‡∏õ‡∏Å‡∏ï‡∏¥">‡∏õ‡∏Å‡∏ï‡∏¥ ‚ö†Ô∏è</option>
                                <option value="‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢">‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ ‚ö†Ô∏è</option>
                                <option value="‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢">‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢ ‚ùå</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="space-y-2">
                        <label for="returnNotes" class="block text-sm font-semibold text-gray-700">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô</label>
                        <textarea id="returnNotes" rows="3" 
                                  class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-300"
                                  placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)"></textarea>
                    </div>
                    
                    <div class="space-y-2">
                        <label for="returnImages" class="block text-sm font-semibold text-gray-700">üì∑ ‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô</label>
                        <input type="file" id="returnImages" multiple accept="image/*" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-300">
                        <p class="text-xs text-gray-500">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö JPG, PNG, GIF - ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô Browser LocalStorage</p>
                        <div id="returnImagePreview" class="mt-3 image-grid"></div>
                    </div>
                    
                    <div class="flex gap-4">
                        <button type="button" onclick="cancelReturn()" 
                                class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 px-6 rounded-xl font-semibold transition-all duration-300">
                            ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                        <button type="submit" 
                                class="flex-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white py-3 px-6 rounded-xl font-semibold transition-all duration-300 transform hover:scale-[1.02] shadow-lg">
                            ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô
                        </button>
                    </div>
                </form>
            </div>

            <!-- History Section -->
            <div id="historySection" class="p-6 hidden">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô</h2>
                    <div class="flex gap-2">
                        <button onclick="loadHistory()" 
                                class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg transition-all duration-300">
                            üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                        </button>
                    </div>
                </div>
                
                <div class="mb-6">
                    <div class="relative">
                        <input type="text" id="historySearch" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥..." 
                               class="w-full px-4 py-3 pl-12 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300">
                        <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
                            üîç
                        </div>
                    </div>
                </div>
                
                <div id="historyStats" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <!-- ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
                </div>
                
                <div id="historyList" class="space-y-4">
                    <!-- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
                </div>
            </div>

            <!-- Analytics Section -->
            <div id="analyticsSection" class="p-6 hidden">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">üìä ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Popular Items -->
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">üèÜ ‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°‡∏ö‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h3>
                        <div id="popularItems" class="space-y-3">
                            <!-- Popular items will be shown here -->
                        </div>
                    </div>
                    
                    <!-- Category Stats -->
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">üìÇ ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</h3>
                        <div id="categoryStats" class="space-y-3">
                            <!-- Category stats will be shown here -->
                        </div>
                    </div>
                    
                    <!-- Monthly Trends -->
                    <div class="bg-white p-6 rounded-xl shadow-lg md:col-span-2">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">üìà ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>
                        <div id="monthlyTrends" class="space-y-3">
                            <!-- Monthly trends will be shown here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settingsSection" class="p-6 hidden">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Export/Import -->
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">üíæ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡∏∞‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                        <div class="space-y-4">
                            <div class="space-y-2">
                                <h4 class="font-medium text-gray-700">üì§ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h4>
                                <div class="flex gap-2">
                                    <button onclick="exportToJSON()" 
                                            class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition-all duration-300">
                                        JSON
                                    </button>
                                    <button onclick="exportToCSV()" 
                                            class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg transition-all duration-300">
                                        CSV
                                    </button>
                                </div>
                            </div>
                            
                            <div class="space-y-2">
                                <h4 class="font-medium text-gray-700">üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h4>
                                <input type="file" id="importFile" accept=".json" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <button onclick="importFromJSON()" 
                                        class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded-lg transition-all duration-300">
                                    ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏à‡∏≤‡∏Å JSON
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- System Info -->
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">‚ÑπÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö</h3>
                        <div class="space-y-3 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡πà‡∏ô:</span>
                                <span class="font-semibold">9.0 GitHub Edition</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:</span>
                                <span class="font-semibold">Browser LocalStorage</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:</span>
                                <span class="font-semibold" id="dataSize">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì...</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:</span>
                                <span class="font-semibold" id="lastUpdate">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Danger Zone -->
                    <div class="bg-red-50 border border-red-200 p-6 rounded-xl md:col-span-2">
                        <h3 class="text-xl font-semibold text-red-800 mb-4">‚ö†Ô∏è ‡πÇ‡∏ã‡∏ô‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢</h3>
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-medium text-red-700 mb-2">‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h4>
                                <p class="text-sm text-red-600 mb-3">‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ</p>
                                <button onclick="clearAllData()" 
                                        class="bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg transition-all duration-300">
                                    üóëÔ∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Status Messages -->
        <div id="statusMessage" class="hidden fixed top-4 right-4 p-4 rounded-xl shadow-2xl z-50 max-w-sm"></div>

        <!-- Enhanced Image Modal -->
        <div id="imageModal" class="hidden fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center p-4">
            <div class="relative max-w-5xl max-h-[95vh] bg-white rounded-2xl overflow-hidden shadow-2xl">
                <button onclick="closeImageModal()" 
                        class="absolute top-4 right-4 bg-black bg-opacity-50 hover:bg-opacity-75 text-white rounded-full w-10 h-10 flex items-center justify-center z-10 transition-all duration-300">
                    ‚úï
                </button>
                <img id="modalImage" src="" alt="" class="max-w-full max-h-[85vh] object-contain">
                <div class="p-6 bg-white">
                    <p id="modalImageName" class="text-lg font-semibold text-gray-800"></p>
                    <p id="modalImageInfo" class="text-sm text-gray-600 mt-1"></p>
                </div>
            </div>
        </div>

        
    </div>

    <script>
        // Global variables
        let borrowImages = [];
        let returnImages = [];
        let currentTab = 'borrow';
        let editingRecordId = null;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // Set default dates
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('borrowDate').value = today;
            document.getElementById('actualReturnDate').value = today;
            
            // Set default return date (7 days from today)
            const returnDate = new Date();
            returnDate.setDate(returnDate.getDate() + 7);
            document.getElementById('returnDate').value = returnDate.toISOString().split('T')[0];
            
            // Initialize event listeners
            setupEventListeners();
            
            // Load initial data
            updateQuickStats();
            updateSystemInfo();
            
        }

        function setupEventListeners() {
            // Image handling
            document.getElementById('borrowImages').addEventListener('change', function(e) {
                handleImageSelection(e.target.files, 'borrow');
            });
            
            document.getElementById('returnImages').addEventListener('change', function(e) {
                handleImageSelection(e.target.files, 'return');
            });
            
            // Form submissions
            document.getElementById('borrowForm').addEventListener('submit', handleBorrowSubmit);
            document.getElementById('returnForm').addEventListener('submit', handleReturnSubmit);
            
            // Search functionality
            document.getElementById('searchBorrow').addEventListener('input', handleBorrowSearch);
            document.getElementById('historySearch').addEventListener('input', handleHistorySearch);
            
            // Modal close on outside click
            document.getElementById('imageModal').addEventListener('click', function(e) {
                if (e.target === this) closeImageModal();
            });
        }

        // Enhanced image handling
        function handleImageSelection(files, type) {
            const imageArray = type === 'borrow' ? borrowImages : returnImages;
            const previewContainer = document.getElementById(type + 'ImagePreview');
            
            // Clear previous images
            imageArray.length = 0;
            previewContainer.innerHTML = '';
            
            if (files.length === 0) return;
            
            Array.from(files).forEach((file, index) => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imageData = {
                            name: file.name,
                            data: e.target.result,
                            size: file.size,
                            type: file.type,
                            uploadDate: new Date().toISOString()
                        };
                        imageArray.push(imageData);
                        
                        // Create enhanced preview
                        const previewDiv = document.createElement('div');
                        previewDiv.className = 'relative group bg-white rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-all duration-300';
                        previewDiv.innerHTML = `
                            <img src="${e.target.result}" alt="${file.name}" 
                                 class="w-full h-20 object-cover cursor-pointer"
                                 onclick="showImageModal('${e.target.result}', '${file.name}', '${formatFileSize(file.size)}')">
                            <button type="button" onclick="removeImage(${index}, '${type}')" 
                                    class="absolute top-1 right-1 bg-red-500 hover:bg-red-600 text-white rounded-full w-6 h-6 text-xs opacity-0 group-hover:opacity-100 transition-all duration-300 flex items-center justify-center">
                                ‚úï
                            </button>
                            <div class="p-2">
                                <p class="text-xs text-gray-600 truncate font-medium">${file.name}</p>
                                <p class="text-xs text-gray-400">${formatFileSize(file.size)}</p>
                            </div>
                        `;
                        previewContainer.appendChild(previewDiv);
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        function removeImage(index, type) {
            const imageArray = type === 'borrow' ? borrowImages : returnImages;
            const previewContainer = document.getElementById(type + 'ImagePreview');
            
            imageArray.splice(index, 1);
            if (previewContainer.children[index]) {
                previewContainer.children[index].remove();
            }
            
            // Re-index remaining images
            Array.from(previewContainer.children).forEach((child, newIndex) => {
                const button = child.querySelector('button');
                if (button) {
                    button.setAttribute('onclick', `removeImage(${newIndex}, '${type}')`);
                }
            });
        }

        // Enhanced tab navigation
        function showTab(tab) {
            // Hide all sections
            const sections = ['borrowSection', 'returnSection', 'historySection', 'analyticsSection', 'settingsSection'];
            sections.forEach(section => {
                document.getElementById(section).classList.add('hidden');
            });

            // Remove active class from all tabs
            document.querySelectorAll('[id$="Tab"]').forEach(t => {
                t.classList.remove('border-indigo-500', 'text-indigo-600', 'border-b-3');
                t.classList.add('text-gray-500');
            });

            // Show selected section and activate tab
            document.getElementById(tab + 'Section').classList.remove('hidden');
            const activeTab = document.getElementById(tab + 'Tab');
            activeTab.classList.add('border-indigo-500', 'text-indigo-600', 'border-b-3');
            activeTab.classList.remove('text-gray-500');
            
            currentTab = tab;

            // Load data based on tab
            switch(tab) {
                case 'return':
                    loadBorrowList();
                    break;
                case 'history':
                    loadHistory();
                    break;
                case 'analytics':
                    loadAnalytics();
                    break;
                case 'settings':
                    updateSystemInfo();
                    break;
            }
        }

        // Enhanced form handling
        function handleBorrowSubmit(e) {
            e.preventDefault();
            
            const borrowData = {
                id: editingRecordId || Date.now().toString(),
                borrowerName: document.getElementById('borrowerName').value.trim(),
                borrowerPhone: document.getElementById('borrowerPhone').value.trim(),
                itemName: document.getElementById('itemName').value.trim(),
                quantity: 1,
                category: '‡∏≠‡∏∑‡πà‡∏ô‡πÜ',
                borrowDate: document.getElementById('borrowDate').value,
                returnDate: document.getElementById('returnDate').value,
                notes: document.getElementById('notes').value.trim(),
                status: '‡∏¢‡∏∑‡∏°',
                timestamp: editingRecordId ? getOriginalTimestamp(editingRecordId) : new Date().toISOString(),
                borrowImages: [...borrowImages]
            };

            // Validation
            if (!borrowData.borrowerName || !borrowData.itemName) {
                showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô', 'error');
                return;
            }

            if (editingRecordId) {
                // Update existing record
                updateBorrowRecordData(borrowData);
                showMessage(`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ "${borrowData.itemName}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‚úèÔ∏è`, 'success');
                cancelEdit();
            } else {
                // Save new record
                saveBorrowRecord(borrowData);
                showMessage(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏° "${borrowData.itemName}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üéâ`, 'success');
                clearBorrowForm();
            }
            
            // Update displays
            updateQuickStats();
            loadBorrowList();
        }

        function getOriginalTimestamp(id) {
            const records = JSON.parse(localStorage.getItem('borrowRecords') || '[]');
            const record = records.find(r => r.id === id);
            return record ? record.timestamp : new Date().toISOString();
        }

        function updateBorrowRecordData(updatedData) {
            let records = JSON.parse(localStorage.getItem('borrowRecords') || '[]');
            const index = records.findIndex(r => r.id === updatedData.id);
            
            if (index !== -1) {
                // Preserve return data if exists
                const existingRecord = records[index];
                records[index] = {
                    ...updatedData,
                    actualReturnDate: existingRecord.actualReturnDate,
                    condition: existingRecord.condition,
                    returnNotes: existingRecord.returnNotes,
                    returnTimestamp: existingRecord.returnTimestamp,
                    returnImages: existingRecord.returnImages,
                    status: existingRecord.status
                };
                
                localStorage.setItem('borrowRecords', JSON.stringify(records));
                localStorage.setItem('lastUpdate', new Date().toISOString());
            }
        }

        function handleReturnSubmit(e) {
            e.preventDefault();
            
            const borrowId = document.getElementById('returnBorrowId').value;
            const returnData = {
                actualReturnDate: document.getElementById('actualReturnDate').value,
                condition: document.getElementById('condition').value,
                returnNotes: document.getElementById('returnNotes').value.trim(),
                returnTimestamp: new Date().toISOString(),
                returnImages: [...returnImages]
            };

            updateBorrowRecord(borrowId, returnData);
            
            // Reset form
            document.getElementById('returnForm').reset();
            document.getElementById('returnForm').classList.add('hidden');
            document.getElementById('actualReturnDate').value = new Date().toISOString().split('T')[0];
            returnImages.length = 0;
            document.getElementById('returnImagePreview').innerHTML = '';
            
            // Update displays
            loadBorrowList();
            updateQuickStats();
            
            showMessage('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‚úÖ', 'success');
        }

        // Enhanced data management
        function saveBorrowRecord(data) {
            let records = JSON.parse(localStorage.getItem('borrowRecords') || '[]');
            records.push(data);
            localStorage.setItem('borrowRecords', JSON.stringify(records));
            localStorage.setItem('lastUpdate', new Date().toISOString());
        }

        function updateBorrowRecord(id, returnData) {
            let records = JSON.parse(localStorage.getItem('borrowRecords') || '[]');
            const index = records.findIndex(r => r.id === id);
            if (index !== -1) {
                records[index] = { ...records[index], ...returnData, status: '‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß' };
                localStorage.setItem('borrowRecords', JSON.stringify(records));
                localStorage.setItem('lastUpdate', new Date().toISOString());
            }
        }

        // Enhanced UI functions
        function clearBorrowForm() {
            document.getElementById('borrowForm').reset();
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('borrowDate').value = today;
            
            const returnDate = new Date();
            returnDate.setDate(returnDate.getDate() + 7);
            document.getElementById('returnDate').value = returnDate.toISOString().split('T')[0];
            
            borrowImages.length = 0;
            document.getElementById('borrowImagePreview').innerHTML = '';
        }

        function cancelReturn() {
            document.getElementById('returnForm').classList.add('hidden');
            document.getElementById('returnForm').reset();
            returnImages.length = 0;
            document.getElementById('returnImagePreview').innerHTML = '';
        }

        // Enhanced statistics
        function updateQuickStats() {
            const records = JSON.parse(localStorage.getItem('borrowRecords') || '[]');
            const totalRecords = records.length;
            const activeRecords = records.filter(r => r.status === '‡∏¢‡∏∑‡∏°').length;
            const returnedRecords = records.filter(r => r.status === '‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß').length;
            const overdueRecords = records.filter(r => 
                r.status === '‡∏¢‡∏∑‡∏°' && new Date(r.returnDate) < new Date()
            ).length;

            document.getElementById('quickStats').innerHTML = `
                <div class="stats-card bg-gradient-to-br from-blue-500 to-blue-600 text-white p-4 rounded-xl shadow-lg">
                    <div class="text-2xl font-bold">${totalRecords}</div>
                    <div class="text-sm opacity-90">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                </div>
                <div class="stats-card bg-gradient-to-br from-yellow-500 to-orange-500 text-white p-4 rounded-xl shadow-lg">
                    <div class="text-2xl font-bold">${activeRecords}</div>
                    <div class="text-sm opacity-90">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏°</div>
                </div>
                <div class="stats-card bg-gradient-to-br from-green-500 to-emerald-500 text-white p-4 rounded-xl shadow-lg">
                    <div class="text-2xl font-bold">${returnedRecords}</div>
                    <div class="text-sm opacity-90">‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß</div>
                </div>
                <div class="stats-card bg-gradient-to-br from-red-500 to-pink-500 text-white p-4 rounded-xl shadow-lg">
                    <div class="text-2xl font-bold">${overdueRecords}</div>
                    <div class="text-sm opacity-90">‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î</div>
                </div>
            `;

            // Update active items count in return section
            const activeItemsCount = document.getElementById('activeItemsCount');
            if (activeItemsCount) {
                activeItemsCount.textContent = activeRecords;
            }
        }

        // Enhanced borrow list loading
        function loadBorrowList() {
            const records = JSON.parse(localStorage.getItem('borrowRecords') || '[]');
            const activeRecords = records.filter(r => r.status === '‡∏¢‡∏∑‡∏°');
            const borrowList = document.getElementById('borrowList');
            
            if (activeRecords.length === 0) {
                borrowList.innerHTML = `
                    <div class="text-center py-12 text-gray-500">
                        <div class="text-6xl mb-4">üì≠</div>
                        <h3 class="text-xl font-semibold mb-2">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏∑‡∏ô</h3>
                        <p class="text-sm">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏Ç‡∏≠‡∏á ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
                    </div>
                `;
                return;
            }

            borrowList.innerHTML = activeRecords.map(record => {
                const isOverdue = new Date(record.returnDate) < new Date();
                const daysUntilReturn = Math.ceil((new Date(record.returnDate) - new Date()) / (1000 * 60 * 60 * 24));
                
                return `
                    <div class="border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-all duration-300 ${isOverdue ? 'border-red-300 bg-red-50' : 'hover:bg-gray-50'}">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-3">
                                    <h4 class="text-xl font-semibold text-gray-800">${record.itemName}</h4>
                                </div>
                                <div class="grid md:grid-cols-2 gap-4 text-sm text-gray-600">
                                    <div class="space-y-1">
                                        <p><span class="font-medium">üë§ ‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°:</span> ${record.borrowerName}</p>
                                        <p><span class="font-medium">üìû ‡πÄ‡∏ö‡∏≠‡∏£‡πå:</span> ${record.borrowerPhone}</p>
                                    </div>
                                    <div class="space-y-1">
                                        <p><span class="font-medium">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°:</span> ${formatDate(record.borrowDate)}</p>
                                        <p><span class="font-medium">‚è∞ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô:</span> ${formatDate(record.returnDate)}</p>
                                        <p class="${isOverdue ? 'text-red-600 font-semibold' : daysUntilReturn <= 3 ? 'text-orange-600 font-semibold' : 'text-gray-600'}">
                                            ${isOverdue ? '‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î ' + Math.abs(daysUntilReturn) + ' ‡∏ß‡∏±‡∏ô' : 
                                              daysUntilReturn <= 3 ? '‚ö†Ô∏è ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ' + daysUntilReturn + ' ‡∏ß‡∏±‡∏ô' : 
                                              '‚úÖ ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ' + daysUntilReturn + ' ‡∏ß‡∏±‡∏ô'}
                                        </p>
                                    </div>
                                </div>
                                ${record.notes ? `<p class="text-sm text-gray-600 mt-3 bg-gray-100 p-2 rounded-lg">üí¨ ${record.notes}</p>` : ''}
                            </div>
                            <div class="flex flex-col items-end gap-2">
                                <span class="px-3 py-1 rounded-full text-xs font-semibold ${
                                    isOverdue ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800'
                                }">
                                    ${record.status}
                                </span>
                                <div class="flex gap-2">
                                    <button onclick="editBorrowRecord('${record.id}')" class="text-blue-600 hover:text-blue-800 text-sm font-medium px-2 py-1 rounded hover:bg-blue-50 transition-all duration-300">
                                        ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                    </button>
                                    <button onclick="selectForReturn('${record.id}')" class="text-indigo-600 hover:text-indigo-800 text-sm font-medium px-2 py-1 rounded hover:bg-indigo-50 transition-all duration-300">
                                        üì• ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡∏≠‡∏á
                                    </button>
                                    <button onclick="deleteBorrowRecord('${record.id}')" class="text-red-600 hover:text-red-800 text-sm font-medium px-2 py-1 rounded hover:bg-red-50 transition-all duration-300">
                                        üóëÔ∏è ‡∏•‡∏ö
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Enhanced return selection
        function selectForReturn(id) {
            const records = JSON.parse(localStorage.getItem('borrowRecords') || '[]');
            const record = records.find(r => r.id === id);
            
            if (record) {
                document.getElementById('returnBorrowId').value = id;
                
                const isOverdue = new Date(record.returnDate) < new Date();
                const daysUntilReturn = Math.ceil((new Date(record.returnDate) - new Date()) / (1000 * 60 * 60 * 24));
                
                document.getElementById('returnItemInfo').innerHTML = `
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <p><span class="font-semibold">üì¶ ‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á:</span> ${record.itemName}</p>
                            <p><span class="font-semibold">üë§ ‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°:</span> ${record.borrowerName}</p>
                            <p><span class="font-semibold">üìû ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</span> ${record.borrowerPhone}</p>
                        </div>
                        <div class="space-y-2">
                            <p><span class="font-semibold">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°:</span> ${formatDate(record.borrowDate)}</p>
                            <p><span class="font-semibold">‚è∞ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô:</span> ${formatDate(record.returnDate)}</p>
                            <p class="${isOverdue ? 'text-red-600 font-semibold' : daysUntilReturn <= 3 ? 'text-orange-600 font-semibold' : 'text-green-600'}">
                                ${isOverdue ? '‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î ' + Math.abs(daysUntilReturn) + ' ‡∏ß‡∏±‡∏ô' : 
                                  daysUntilReturn <= 3 ? '‚ö†Ô∏è ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ' + daysUntilReturn + ' ‡∏ß‡∏±‡∏ô' : 
                                  '‚úÖ ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ' + daysUntilReturn + ' ‡∏ß‡∏±‡∏ô'}
                            </p>
                        </div>
                    </div>
                    ${record.notes ? `<div class="mt-3 p-3 bg-gray-100 rounded-lg"><span class="font-semibold">üí¨ ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</span> ${record.notes}</div>` : ''}
                `;
                
                document.getElementById('returnForm').classList.remove('hidden');
                document.getElementById('returnForm').scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Edit and Delete Functions
        function editBorrowRecord(id) {
            const records = JSON.parse(localStorage.getItem('borrowRecords') || '[]');
            const record = records.find(r => r.id === id);
            
            if (!record) {
                showMessage('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç', 'error');
                return;
            }

            // Switch to borrow tab
            showTab('borrow');
            
            // Fill form with existing data
            document.getElementById('borrowerName').value = record.borrowerName;
            document.getElementById('borrowerPhone').value = record.borrowerPhone;
            document.getElementById('itemName').value = record.itemName;
            document.getElementById('borrowDate').value = record.borrowDate;
            document.getElementById('returnDate').value = record.returnDate;
            document.getElementById('notes').value = record.notes || '';
            
            // Set images
            borrowImages = record.borrowImages || [];
            displayEditImages();
            
            // Set editing mode
            editingRecordId = id;
            
            // Update form UI
            const submitButton = document.querySelector('#borrowForm button[type="submit"]');
            submitButton.innerHTML = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç';
            submitButton.className = 'w-full bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white py-4 px-6 rounded-xl font-semibold text-lg transition-all duration-300 transform hover:scale-[1.02] shadow-lg';
            
            // Add cancel button
            if (!document.getElementById('cancelEditBtn')) {
                const cancelBtn = document.createElement('button');
                cancelBtn.type = 'button';
                cancelBtn.id = 'cancelEditBtn';
                cancelBtn.className = 'w-full bg-gray-500 hover:bg-gray-600 text-white py-3 px-6 rounded-xl font-semibold transition-all duration-300 mt-3';
                cancelBtn.innerHTML = '‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç';
                cancelBtn.onclick = cancelEdit;
                submitButton.parentNode.appendChild(cancelBtn);
            }
            
            // Scroll to form
            document.getElementById('borrowForm').scrollIntoView({ behavior: 'smooth' });
            
            showMessage(`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: ${record.itemName}`, 'info');
        }

        function displayEditImages() {
            const previewContainer = document.getElementById('borrowImagePreview');
            previewContainer.innerHTML = '';
            
            borrowImages.forEach((img, index) => {
                const previewDiv = document.createElement('div');
                previewDiv.className = 'relative group bg-white rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-all duration-300';
                previewDiv.innerHTML = `
                    <img src="${img.data}" alt="${img.name}" 
                         class="w-full h-20 object-cover cursor-pointer"
                         onclick="showImageModal('${img.data}', '${img.name}', '${formatFileSize(img.size)}')">
                    <button type="button" onclick="removeImage(${index}, 'borrow')" 
                            class="absolute top-1 right-1 bg-red-500 hover:bg-red-600 text-white rounded-full w-6 h-6 text-xs opacity-0 group-hover:opacity-100 transition-all duration-300 flex items-center justify-center">
                        ‚úï
                    </button>
                    <div class="p-2">
                        <p class="text-xs text-gray-600 truncate font-medium">${img.name}</p>
                        <p class="text-xs text-gray-400">${formatFileSize(img.size)}</p>
                    </div>
                `;
                previewContainer.appendChild(previewDiv);
            });
        }

        function cancelEdit() {
            editingRecordId = null;
            clearBorrowForm();
            
            // Reset form UI
            const submitButton = document.querySelector('#borrowForm button[type="submit"]');
            submitButton.innerHTML = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°';
            submitButton.className = 'w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white py-4 px-6 rounded-xl font-semibold text-lg transition-all duration-300 transform hover:scale-[1.02] shadow-lg';
            
            // Remove cancel button
            const cancelBtn = document.getElementById('cancelEditBtn');
            if (cancelBtn) {
                cancelBtn.remove();
            }
            
            showMessage('‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß', 'info');
        }

        function deleteBorrowRecord(id) {
            const records = JSON.parse(localStorage.getItem('borrowRecords') || '[]');
            const record = records.find(r => r.id === id);
            
            if (!record) {
                showMessage('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö', 'error');
                return;
            }

            // Create custom confirmation modal
            const confirmModal = document.createElement('div');
            confirmModal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            confirmModal.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-md w-full shadow-2xl">
                    <div class="text-center">
                        <div class="text-6xl mb-4">üóëÔ∏è</div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö</h3>
                        <p class="text-gray-600 mb-4">‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
                        <div class="bg-gray-50 p-4 rounded-lg mb-6 text-left">
                            <p class="font-semibold text-gray-800">${record.itemName}</p>
                            <p class="text-sm text-gray-600">‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°: ${record.borrowerName}</p>
                            <p class="text-sm text-gray-600">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°: ${formatDate(record.borrowDate)}</p>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="this.closest('.fixed').remove()" 
                                    class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 px-4 rounded-xl font-semibold transition-all duration-300">
                                ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                            </button>
                            <button onclick="confirmDelete('${id}'); this.closest('.fixed').remove()" 
                                    class="flex-1 bg-red-600 hover:bg-red-700 text-white py-3 px-4 rounded-xl font-semibold transition-all duration-300">
                                üóëÔ∏è ‡∏•‡∏ö
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(confirmModal);
        }

        function confirmDelete(id) {
            let records = JSON.parse(localStorage.getItem('borrowRecords') || '[]');
            const recordIndex = records.findIndex(r => r.id === id);
            
            if (recordIndex === -1) {
                showMessage('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö', 'error');
                return;
            }

            const deletedRecord = records[recordIndex];
            records.splice(recordIndex, 1);
            
            localStorage.setItem('borrowRecords', JSON.stringify(records));
            localStorage.setItem('lastUpdate', new Date().toISOString());
            
            // Update displays
            updateQuickStats();
            loadBorrowList();
            if (currentTab === 'history') loadHistory();
            if (currentTab === 'analytics') loadAnalytics();
            
            showMessage(`‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ "${deletedRecord.itemName}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üóëÔ∏è`, 'success');
        }

        // Enhanced history loading
        function loadHistory() {
            const records = JSON.parse(localStorage.getItem('borrowRecords') || '[]');
            const historyList = document.getElementById('historyList');
            const historyStats = document.getElementById('historyStats');
            
            // Calculate detailed statistics
            const totalRecords = records.length;
            const activeRecords = records.filter(r => r.status === '‡∏¢‡∏∑‡∏°').length;
            const returnedRecords = records.filter(r => r.status === '‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß').length;
            const overdueRecords = records.filter(r => 
                r.status === '‡∏¢‡∏∑‡∏°' && new Date(r.returnDate) < new Date()
            ).length;
            
            // Display enhanced statistics
            historyStats.innerHTML = `
                <div class="stats-card bg-gradient-to-br from-blue-500 to-blue-600 text-white p-6 rounded-xl shadow-lg">
                    <div class="text-3xl font-bold mb-2">${totalRecords}</div>
                    <div class="text-sm opacity-90">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                </div>
                <div class="stats-card bg-gradient-to-br from-yellow-500 to-orange-500 text-white p-6 rounded-xl shadow-lg">
                    <div class="text-3xl font-bold mb-2">${activeRecords}</div>
                    <div class="text-sm opacity-90">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏°</div>
                </div>
                <div class="stats-card bg-gradient-to-br from-green-500 to-emerald-500 text-white p-6 rounded-xl shadow-lg">
                    <div class="text-3xl font-bold mb-2">${returnedRecords}</div>
                    <div class="text-sm opacity-90">‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß</div>
                </div>
                <div class="stats-card bg-gradient-to-br from-red-500 to-pink-500 text-white p-6 rounded-xl shadow-lg">
                    <div class="text-3xl font-bold mb-2">${overdueRecords}</div>
                    <div class="text-sm opacity-90">‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î</div>
                </div>
            `;
            
            if (records.length === 0) {
                historyList.innerHTML = `
                    <div class="text-center py-12 text-gray-500">
                        <div class="text-6xl mb-4">üìã</div>
                        <h3 class="text-xl font-semibold mb-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô</h3>
                        <p class="text-sm">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                    </div>
                `;
                return;
            }

            // Sort records by timestamp (newest first)
            const sortedRecords = records.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            historyList.innerHTML = sortedRecords.map(record => {
                const isOverdue = record.status === '‡∏¢‡∏∑‡∏°' && new Date(record.returnDate) < new Date();
                
                return `
                    <div class="bg-white border border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-md transition-all duration-300">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-2">
                                    <h4 class="text-xl font-semibold text-gray-800">${record.itemName}</h4>
                                </div>
                                <div class="grid md:grid-cols-2 gap-6 text-sm text-gray-600">
                                    <div class="space-y-2">
                                        <p><span class="font-medium">üë§ ‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°:</span> ${record.borrowerName}</p>
                                        <p><span class="font-medium">üìû ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</span> ${record.borrowerPhone}</p>
                                    </div>
                                    <div class="space-y-2">
                                        <p><span class="font-medium">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°:</span> ${formatDate(record.borrowDate)}</p>
                                        <p><span class="font-medium">‚è∞ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô:</span> ${formatDate(record.returnDate)}</p>
                                        ${record.actualReturnDate ? `<p><span class="font-medium">‚úÖ ‡∏Ñ‡∏∑‡∏ô‡∏à‡∏£‡∏¥‡∏á:</span> ${formatDate(record.actualReturnDate)}</p>` : ''}
                                        ${record.condition ? `<p><span class="font-medium">üîç ‡∏™‡∏†‡∏≤‡∏û:</span> <span class="font-semibold ${getConditionColor(record.condition)}">${record.condition}</span></p>` : ''}
                                    </div>
                                </div>
                                ${record.notes ? `<div class="mt-3 p-3 bg-gray-50 rounded-lg"><span class="font-medium">üí¨ ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</span> ${record.notes}</div>` : ''}
                                ${record.returnNotes ? `<div class="mt-2 p-3 bg-blue-50 rounded-lg"><span class="font-medium">üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô:</span> ${record.returnNotes}</div>` : ''}
                                
                                ${record.borrowImages && record.borrowImages.length > 0 ? `
                                    <div class="mt-4">
                                        <p class="text-sm font-semibold text-gray-700 mb-2">üì∑ ‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏° (${record.borrowImages.length} ‡∏£‡∏π‡∏õ)</p>
                                        <div class="image-grid">
                                            ${record.borrowImages.map(img => `
                                                <img src="${img.data}" alt="${img.name}" 
                                                     class="w-full h-16 object-cover rounded-lg border border-gray-200 cursor-pointer hover:opacity-80 transition-opacity"
                                                     onclick="showImageModal('${img.data}', '${img.name}', '${formatFileSize(img.size)}')">
                                            `).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                                
                                ${record.returnImages && record.returnImages.length > 0 ? `
                                    <div class="mt-4">
                                        <p class="text-sm font-semibold text-gray-700 mb-2">üì∑ ‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô (${record.returnImages.length} ‡∏£‡∏π‡∏õ)</p>
                                        <div class="image-grid">
                                            ${record.returnImages.map(img => `
                                                <img src="${img.data}" alt="${img.name}" 
                                                     class="w-full h-16 object-cover rounded-lg border border-gray-200 cursor-pointer hover:opacity-80 transition-opacity"
                                                     onclick="showImageModal('${img.data}', '${img.name}', '${formatFileSize(img.size)}')">
                                            `).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                            <div class="flex flex-col items-end gap-2">
                                <span class="px-3 py-1 rounded-full text-xs font-semibold ${
                                    record.status === '‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß' 
                                        ? 'bg-green-100 text-green-800' 
                                        : isOverdue 
                                            ? 'bg-red-100 text-red-800'
                                            : 'bg-yellow-100 text-yellow-800'
                                }">
                                    ${record.status}${isOverdue ? ' (‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î)' : ''}
                                </span>
                                <p class="text-xs text-gray-500">
                                    ${formatDateTime(record.timestamp)}
                                </p>
                                ${record.status === '‡∏¢‡∏∑‡∏°' ? `
                                    <div class="flex gap-1 mt-2">
                                        <button onclick="editBorrowRecord('${record.id}')" class="text-blue-600 hover:text-blue-800 text-xs px-2 py-1 rounded hover:bg-blue-50 transition-all duration-300">
                                            ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                        </button>
                                        <button onclick="deleteBorrowRecord('${record.id}')" class="text-red-600 hover:text-red-800 text-xs px-2 py-1 rounded hover:bg-red-50 transition-all duration-300">
                                            üóëÔ∏è ‡∏•‡∏ö
                                        </button>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // New analytics function
        function loadAnalytics() {
            const records = JSON.parse(localStorage.getItem('borrowRecords') || '[]');
            
            // Popular items analysis
            const itemCounts = {};
            records.forEach(record => {
                itemCounts[record.itemName] = (itemCounts[record.itemName] || 0) + 1;
            });
            
            const popularItems = Object.entries(itemCounts)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5);
            
            document.getElementById('popularItems').innerHTML = popularItems.length > 0 
                ? popularItems.map(([item, count], index) => `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center gap-3">
                            <span class="text-lg">${index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üèÖ'}</span>
                            <span class="font-medium">${item}</span>
                        </div>
                        <span class="bg-indigo-100 text-indigo-800 px-2 py-1 rounded-full text-sm font-semibold">
                            ${count} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                        </span>
                    </div>
                `).join('')
                : '<p class="text-gray-500 text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠</p>';
            
            // Category analysis
            const categoryCounts = {};
            records.forEach(record => {
                const category = record.category || '‡∏≠‡∏∑‡πà‡∏ô‡πÜ';
                categoryCounts[category] = (categoryCounts[category] || 0) + 1;
            });
            
            const categoryStats = Object.entries(categoryCounts)
                .sort(([,a], [,b]) => b - a);
            
            document.getElementById('categoryStats').innerHTML = categoryStats.length > 0
                ? categoryStats.map(([category, count]) => `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <span class="font-medium">${category}</span>
                        <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-sm font-semibold">
                            ${count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                        </span>
                    </div>
                `).join('')
                : '<p class="text-gray-500 text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠</p>';
            
            // Monthly trends
            const monthlyData = {};
            records.forEach(record => {
                const month = new Date(record.borrowDate).toLocaleDateString('th-TH', { year: 'numeric', month: 'long' });
                monthlyData[month] = (monthlyData[month] || 0) + 1;
            });
            
            const monthlyTrends = Object.entries(monthlyData)
                .sort(([a], [b]) => new Date(a) - new Date(b))
                .slice(-6); // Last 6 months
            
            document.getElementById('monthlyTrends').innerHTML = monthlyTrends.length > 0
                ? monthlyTrends.map(([month, count]) => `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <span class="font-medium">${month}</span>
                        <div class="flex items-center gap-2">
                            <div class="bg-blue-200 h-2 rounded-full" style="width: ${(count / Math.max(...monthlyTrends.map(([,c]) => c))) * 100}px"></div>
                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-sm font-semibold">
                                ${count}
                            </span>
                        </div>
                    </div>
                `).join('')
                : '<p class="text-gray-500 text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠</p>';
        }

        // Enhanced search functions
        function handleBorrowSearch(e) {
            const searchTerm = e.target.value.toLowerCase();
            const records = JSON.parse(localStorage.getItem('borrowRecords') || '[]');
            const filteredRecords = records.filter(r => 
                r.status === '‡∏¢‡∏∑‡∏°' && 
                (r.borrowerName.toLowerCase().includes(searchTerm) || 
                 r.itemName.toLowerCase().includes(searchTerm) ||
                 (r.category && r.category.toLowerCase().includes(searchTerm)))
            );
            
            displayFilteredBorrowList(filteredRecords);
        }

        function handleHistorySearch(e) {
            const searchTerm = e.target.value.toLowerCase();
            const records = JSON.parse(localStorage.getItem('borrowRecords') || '[]');
            const filteredRecords = records.filter(r => 
                r.borrowerName.toLowerCase().includes(searchTerm) || 
                r.itemName.toLowerCase().includes(searchTerm) ||
                (r.category && r.category.toLowerCase().includes(searchTerm))
            );
            
            displayFilteredHistory(filteredRecords);
        }

        function displayFilteredBorrowList(records) {
            const borrowList = document.getElementById('borrowList');
            
            if (records.length === 0) {
                borrowList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-2">üîç</div>
                        <p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>
                    </div>
                `;
                return;
            }

            // Use same display logic as loadBorrowList but with filtered records
            borrowList.innerHTML = records.map(record => {
                const isOverdue = new Date(record.returnDate) < new Date();
                const daysUntilReturn = Math.ceil((new Date(record.returnDate) - new Date()) / (1000 * 60 * 60 * 24));
                
                return `
                    <div class="border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-all duration-300 ${isOverdue ? 'border-red-300 bg-red-50' : 'hover:bg-gray-50'}">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-3">
                                    <h4 class="text-xl font-semibold text-gray-800">${record.itemName}</h4>
                                </div>
                                <div class="grid md:grid-cols-2 gap-4 text-sm text-gray-600">
                                    <div class="space-y-1">
                                        <p><span class="font-medium">üë§ ‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°:</span> ${record.borrowerName}</p>
                                        <p><span class="font-medium">üìû ‡πÄ‡∏ö‡∏≠‡∏£‡πå:</span> ${record.borrowerPhone}</p>
                                    </div>
                                    <div class="space-y-1">
                                        <p><span class="font-medium">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°:</span> ${formatDate(record.borrowDate)}</p>
                                        <p><span class="font-medium">‚è∞ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô:</span> ${formatDate(record.returnDate)}</p>
                                        <p class="${isOverdue ? 'text-red-600 font-semibold' : daysUntilReturn <= 3 ? 'text-orange-600 font-semibold' : 'text-gray-600'}">
                                            ${isOverdue ? '‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î ' + Math.abs(daysUntilReturn) + ' ‡∏ß‡∏±‡∏ô' : 
                                              daysUntilReturn <= 3 ? '‚ö†Ô∏è ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ' + daysUntilReturn + ' ‡∏ß‡∏±‡∏ô' : 
                                              '‚úÖ ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ' + daysUntilReturn + ' ‡∏ß‡∏±‡∏ô'}
                                        </p>
                                    </div>
                                </div>
                                ${record.notes ? `<p class="text-sm text-gray-600 mt-3 bg-gray-100 p-2 rounded-lg">üí¨ ${record.notes}</p>` : ''}
                            </div>
                            <div class="flex flex-col items-end gap-2">
                                <span class="px-3 py-1 rounded-full text-xs font-semibold ${
                                    isOverdue ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800'
                                }">
                                    ${record.status}
                                </span>
                                <div class="flex gap-2">
                                    <button onclick="editBorrowRecord('${record.id}')" class="text-blue-600 hover:text-blue-800 text-sm font-medium px-2 py-1 rounded hover:bg-blue-50 transition-all duration-300">
                                        ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                    </button>
                                    <button onclick="selectForReturn('${record.id}')" class="text-indigo-600 hover:text-indigo-800 text-sm font-medium px-2 py-1 rounded hover:bg-indigo-50 transition-all duration-300">
                                        üì• ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡∏≠‡∏á
                                    </button>
                                    <button onclick="deleteBorrowRecord('${record.id}')" class="text-red-600 hover:text-red-800 text-sm font-medium px-2 py-1 rounded hover:bg-red-50 transition-all duration-300">
                                        üóëÔ∏è ‡∏•‡∏ö
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function displayFilteredHistory(records) {
            const historyList = document.getElementById('historyList');
            
            if (records.length === 0) {
                historyList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-2">üîç</div>
                        <p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>
                    </div>
                `;
                return;
            }

            // Sort and display filtered records
            const sortedRecords = records.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            historyList.innerHTML = sortedRecords.map(record => {
                const isOverdue = record.status === '‡∏¢‡∏∑‡∏°' && new Date(record.returnDate) < new Date();
                
                return `
                    <div class="bg-white border border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-md transition-all duration-300">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-2">
                                    <h4 class="text-xl font-semibold text-gray-800">${record.itemName}</h4>
                                </div>
                                <div class="grid md:grid-cols-2 gap-6 text-sm text-gray-600">
                                    <div class="space-y-2">
                                        <p><span class="font-medium">üë§ ‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°:</span> ${record.borrowerName}</p>
                                        <p><span class="font-medium">üìû ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</span> ${record.borrowerPhone}</p>
                                    </div>
                                    <div class="space-y-2">
                                        <p><span class="font-medium">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°:</span> ${formatDate(record.borrowDate)}</p>
                                        <p><span class="font-medium">‚è∞ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô:</span> ${formatDate(record.returnDate)}</p>
                                        ${record.actualReturnDate ? `<p><span class="font-medium">‚úÖ ‡∏Ñ‡∏∑‡∏ô‡∏à‡∏£‡∏¥‡∏á:</span> ${formatDate(record.actualReturnDate)}</p>` : ''}
                                        ${record.condition ? `<p><span class="font-medium">üîç ‡∏™‡∏†‡∏≤‡∏û:</span> <span class="font-semibold ${getConditionColor(record.condition)}">${record.condition}</span></p>` : ''}
                                    </div>
                                </div>
                                ${record.notes ? `<div class="mt-3 p-3 bg-gray-50 rounded-lg"><span class="font-medium">üí¨ ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</span> ${record.notes}</div>` : ''}
                                ${record.returnNotes ? `<div class="mt-2 p-3 bg-blue-50 rounded-lg"><span class="font-medium">üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô:</span> ${record.returnNotes}</div>` : ''}
                                
                                ${record.borrowImages && record.borrowImages.length > 0 ? `
                                    <div class="mt-4">
                                        <p class="text-sm font-semibold text-gray-700 mb-2">üì∑ ‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏° (${record.borrowImages.length} ‡∏£‡∏π‡∏õ)</p>
                                        <div class="image-grid">
                                            ${record.borrowImages.map(img => `
                                                <img src="${img.data}" alt="${img.name}" 
                                                     class="w-full h-16 object-cover rounded-lg border border-gray-200 cursor-pointer hover:opacity-80 transition-opacity"
                                                     onclick="showImageModal('${img.data}', '${img.name}', '${formatFileSize(img.size)}')">
                                            `).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                                
                                ${record.returnImages && record.returnImages.length > 0 ? `
                                    <div class="mt-4">
                                        <p class="text-sm font-semibold text-gray-700 mb-2">üì∑ ‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô (${record.returnImages.length} ‡∏£‡∏π‡∏õ)</p>
                                        <div class="image-grid">
                                            ${record.returnImages.map(img => `
                                                <img src="${img.data}" alt="${img.name}" 
                                                     class="w-full h-16 object-cover rounded-lg border border-gray-200 cursor-pointer hover:opacity-80 transition-opacity"
                                                     onclick="showImageModal('${img.data}', '${img.name}', '${formatFileSize(img.size)}')">
                                            `).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                            <div class="flex flex-col items-end gap-2">
                                <span class="px-3 py-1 rounded-full text-xs font-semibold ${
                                    record.status === '‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß' 
                                        ? 'bg-green-100 text-green-800' 
                                        : isOverdue 
                                            ? 'bg-red-100 text-red-800'
                                            : 'bg-yellow-100 text-yellow-800'
                                }">
                                    ${record.status}${isOverdue ? ' (‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î)' : ''}
                                </span>
                                <p class="text-xs text-gray-500">
                                    ${formatDateTime(record.timestamp)}
                                </p>
                                ${record.status === '‡∏¢‡∏∑‡∏°' ? `
                                    <div class="flex gap-1 mt-2">
                                        <button onclick="editBorrowRecord('${record.id}')" class="text-blue-600 hover:text-blue-800 text-xs px-2 py-1 rounded hover:bg-blue-50 transition-all duration-300">
                                            ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                        </button>
                                        <button onclick="deleteBorrowRecord('${record.id}')" class="text-red-600 hover:text-red-800 text-xs px-2 py-1 rounded hover:bg-red-50 transition-all duration-300">
                                            üóëÔ∏è ‡∏•‡∏ö
                                        </button>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Enhanced export/import functions
        function exportToJSON() {
            const records = JSON.parse(localStorage.getItem('borrowRecords') || '[]');
            const exportData = {
                version: '9.0',
                exportDate: new Date().toISOString(),
                totalRecords: records.length,
                records: records
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `borrow-return-v9-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showMessage(`‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${records.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üìÅ`, 'success');
        }

        function exportToCSV() {
            const records = JSON.parse(localStorage.getItem('borrowRecords') || '[]');
            
            if (records.length === 0) {
                showMessage('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å', 'error');
                return;
            }
            
            const headers = [
                'ID', '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°', '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£', '‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á', 
                '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°', '‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∑‡∏ô‡∏à‡∏£‡∏¥‡∏á', '‡∏™‡∏†‡∏≤‡∏û', '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞', 
                '‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏', '‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å'
            ];
            
            const csvContent = [
                headers.join(','),
                ...records.map(record => [
                    record.id,
                    `"${record.borrowerName}"`,
                    record.borrowerPhone,
                    `"${record.itemName}"`,
                    record.borrowDate,
                    record.returnDate,
                    record.actualReturnDate || '',
                    record.condition || '',
                    record.status,
                    `"${record.notes || ''}"`,
                    `"${record.returnNotes || ''}"`,
                    record.timestamp
                ].join(','))
            ].join('\n');
            
            const dataBlob = new Blob(['\ufeff' + csvContent], {type: 'text/csv;charset=utf-8'});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `borrow-return-v9-${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            
            showMessage(`‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• CSV ${records.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üìä`, 'success');
        }

        function importFromJSON() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå JSON', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // Handle both old and new format
                    let records = [];
                    if (Array.isArray(importedData)) {
                        records = importedData; // Old format
                    } else if (importedData.records && Array.isArray(importedData.records)) {
                        records = importedData.records; // New format
                    } else {
                        throw new Error('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                    }
                    
                    // Create confirmation modal
                    const confirmModal = document.createElement('div');
                    confirmModal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
                    confirmModal.innerHTML = `
                        <div class="bg-white rounded-2xl p-6 max-w-md w-full shadow-2xl">
                            <div class="text-center">
                                <div class="text-6xl mb-4">üì•</div>
                                <h3 class="text-xl font-bold text-gray-800 mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤</h3>
                                <p class="text-gray-600 mb-4">‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${records.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                                <p class="text-sm text-red-600 mb-6">‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏à‡∏∞‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                                <div class="flex gap-3">
                                    <button onclick="this.closest('.fixed').remove()" 
                                            class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 px-4 rounded-xl font-semibold transition-all duration-300">
                                        ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                                    </button>
                                    <button onclick="confirmImport(${JSON.stringify(records).replace(/"/g, '&quot;')}); this.closest('.fixed').remove()" 
                                            class="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 px-4 rounded-xl font-semibold transition-all duration-300">
                                        üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    document.body.appendChild(confirmModal);
                } catch (error) {
                    showMessage('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ: ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
        }

        function confirmImport(records) {
            localStorage.setItem('borrowRecords', JSON.stringify(records));
            localStorage.setItem('lastUpdate', new Date().toISOString());
            
            showMessage(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${records.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üéâ`, 'success');
            
            // Refresh all displays
            updateQuickStats();
            updateSystemInfo();
            if (currentTab === 'history') loadHistory();
            if (currentTab === 'return') loadBorrowList();
            if (currentTab === 'analytics') loadAnalytics();
        }

        function clearAllData() {
            const records = JSON.parse(localStorage.getItem('borrowRecords') || '[]');
            
            if (records.length === 0) {
                showMessage('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏•‡∏ö', 'info');
                return;
            }
            
            // Create confirmation modal
            const confirmModal = document.createElement('div');
            confirmModal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            confirmModal.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-md w-full shadow-2xl">
                    <div class="text-center">
                        <div class="text-6xl mb-4">‚ö†Ô∏è</div>
                        <h3 class="text-xl font-bold text-red-800 mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                        <p class="text-gray-600 mb-4">‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${records.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£?</p>
                        <p class="text-sm text-red-600 mb-6">‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ!</p>
                        <div class="flex gap-3">
                            <button onclick="this.closest('.fixed').remove()" 
                                    class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 px-4 rounded-xl font-semibold transition-all duration-300">
                                ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                            </button>
                            <button onclick="confirmClearAll(); this.closest('.fixed').remove()" 
                                    class="flex-1 bg-red-600 hover:bg-red-700 text-white py-3 px-4 rounded-xl font-semibold transition-all duration-300">
                                üóëÔ∏è ‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(confirmModal);
        }

        function confirmClearAll() {
            localStorage.removeItem('borrowRecords');
            localStorage.removeItem('lastUpdate');
            
            showMessage('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß üóëÔ∏è', 'success');
            
            // Refresh all displays
            updateQuickStats();
            updateSystemInfo();
            loadHistory();
            loadBorrowList();
            loadAnalytics();
        }

        // System info functions
        function updateSystemInfo() {
            const records = JSON.parse(localStorage.getItem('borrowRecords') || '[]');
            const dataSize = new Blob([JSON.stringify(records)]).size;
            const lastUpdate = localStorage.getItem('lastUpdate');
            
            const dataSizeElement = document.getElementById('dataSize');
            const lastUpdateElement = document.getElementById('lastUpdate');
            
            if (dataSizeElement) {
                dataSizeElement.textContent = formatFileSize(dataSize);
            }
            
            if (lastUpdateElement) {
                lastUpdateElement.textContent = lastUpdate 
                    ? formatDateTime(lastUpdate)
                    : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
            }
        }

        // Enhanced modal functions
        function showImageModal(imageSrc, imageName, imageSize) {
            document.getElementById('modalImage').src = imageSrc;
            document.getElementById('modalImageName').textContent = imageName;
            document.getElementById('modalImageInfo').textContent = `‡∏Ç‡∏ô‡∏≤‡∏î: ${imageSize || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö'}`;
            document.getElementById('imageModal').classList.remove('hidden');
        }

        function closeImageModal() {
            document.getElementById('imageModal').classList.add('hidden');
        }

        // Enhanced message system
        function showMessage(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };
            
            const colors = {
                success: 'bg-gradient-to-r from-green-500 to-emerald-500 text-white',
                error: 'bg-gradient-to-r from-red-500 to-pink-500 text-white',
                warning: 'bg-gradient-to-r from-yellow-500 to-orange-500 text-white',
                info: 'bg-gradient-to-r from-blue-500 to-indigo-500 text-white'
            };
            
            statusDiv.className = `fixed top-4 right-4 p-4 rounded-xl shadow-2xl z-50 max-w-sm notification-enter ${colors[type] || colors.info}`;
            statusDiv.innerHTML = `
                <div class="flex items-center gap-3">
                    <span class="text-xl">${icons[type] || icons.info}</span>
                    <span class="font-medium">${message}</span>
                </div>
            `;
            statusDiv.classList.remove('hidden');
            
            setTimeout(() => {
                statusDiv.classList.add('hidden');
            }, 5000);
        }

        // Utility functions
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function formatDateTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function getConditionColor(condition) {
            const colors = {
                '‡∏î‡∏µ‡∏°‡∏≤‡∏Å': 'text-green-600',
                '‡∏î‡∏µ': 'text-green-600',
                '‡∏õ‡∏Å‡∏ï‡∏¥': 'text-yellow-600',
                '‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢': 'text-orange-600',
                '‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢': 'text-red-600'
            };
            return colors[condition] || 'text-gray-600';
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98fbfb7c12b8f4cf',t:'MTc2MDY2NDEyMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

